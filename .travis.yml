language: python

python:
  - '3.5'

cache:
  directories:
    - node_modules

before_install:
  - pip install --upgrade pip
  - pip install awscli
  - nvm install 6
  - node -v
  - npm -v

install:
  - npm install

script:
  - npm run lint
  - npm run test
  - npm run spell-check
  - npm run build release

before_deploy:
  - ./scripts/before-deploy.sh

deploy:
  - provider: s3
    access_key_id: $AWS_ACCESS_KEY_ID
    secret_access_key: $AWS_SECRET_ACCESS_KEY
    bucket: $PRODUCTION_BUCKET
    skip_cleanup: true
    acl: public_read
    local_dir: build
    on:
      repo: SkygearIO/skygear-doc
      branch: $PRODUCTION_BRANCH

after_deploy:
  - ./scripts/after-deploy.sh

notifications:
  slack:
    secure: "qpitj7wBLxf4veJr6yeK2Sago2cIuqn39LDaYGS9vhIDAB8/Kc2PV1Fztxl3TsuatqZBkNnMzPFOXKQjU6chj9F/5hb2WWfnF695iGdoA3pfKl45ayd5loDU3ZmzAwJT3zMbe7G/DdVMQ/PItuI511lZq/S6mtUaFdvDQQQsskOUrZBCxc0cJkgETg4MNhznYYyDdo5U5qI5aupb6DLGoy6LIOnWhjfK7opVekke0Dv64p3FO40PMeZmm/JmzSIJTebBPNRdELJvx8C/N7wKecezqz8xN+ajDHE9PqU8mKcFY3zyrAicZNuLMExAf+bKZztXMbZDovU+jNU5x5a7mIh4sHSDjoT3KK06A7mYnVjtnP+okLlrfjRYmcWwttzGNyAZUhNiC5B88WMn11NfLowZTPEZPY+4lmG8BW28nQKki0EwWlKDltbKAUYhJ+OzpVChyJVaCvoE0P8hlujEczJ7G7FwAfNh+5v/z71JbOubLNds4hdZ6ryuPWzvfsMApzyxukrGcJYDjlMIVBSnp/mli5bDMrBlWa8Ak4CLBPA/PlvrOKdij81pxde3pKSR3/4VOJBN8bqY2PFf4dxOqdZ5uZg4LQLTnNpAa08Pf++VthJlVOkaGRxKTfQi/nLRudKHxP16guksMCphML6gm3SV3ckFHesoZoiS7F6BIkE="

env:
  global:
    - PRODUCTION_BRANCH="production-v0"
    - PRODUCTION_BUCKET="docs-v0.skygear.io"
    # AWS_ACCESS_KEY_ID
    - secure: "u/3cyaOW8G4C3/oMSrWPNDEU6CcCmhPSweDwc1EEf/ch0jVC4LfQxtE9kLQRNO9uxCUOgZohMvBn+pArw7b6VPSjnMUhB6rldfjK7R2k+tLH/eSnkCQYaETLoZDqquJmzfrYcFd++pdSwZ8hFRgAOG7UkbII+cK88Q7ZYVeP6HwElLTm+zmyk7S56PQoohGVRgfJbSK34hLJfXMAG7n1nk+WckRX0CmmTMyZlrNOj6XeehXiZLhxY3/uKz0LvMv6ZLK3TgPtwz6jDrUi3uDn1Be6q4DrD3nkcmxjIRrmtvaxYYDw/Ulheg+eOuQwfMvr2RiUgeYOMDCqgqO2ljoMEvcZEBEc41WqHFakDHKWBOA4ideicVY1Y6QWpUah2p/ATPaPi3j0JkMtm3eer60+587viGfyomiH7YoeO5hUAXopipd0cmy+VzEzE7Jvw7vfes4isG+g7JWvKLh6L97tX9YhtmLcffqAmb8p7jJzn9kFMdRAYd+zsAgf0miQDUtDnhT/BTxHHafYvrTXOL+iAm9AVazyLr1XqsPtY2NxhhIK46ePEB6ivpqCaKnrVcvSVdxPTRvcQgnmz36MF4/OXLVz95x8kUOzrK0a8+OP8w7+M+iGcic0zZdMqG7iFKv6zRthx67wGgg71VzmPaqhHa6fxHAj6w7VEK68NJ/6fjg="
    # AWS_SECRET_ACCESS_KEY
    - secure: "RLHv4JHUu9dEtzH2vxTCaIZeFV0cGAxg559HxIO1IrdjDtnQD3h64u9PY0Ad5qRQaBoykuvXhy+3b9tDphX6OpWIWP7s30sniLOxpnRuAnoZHFTZ3KPjN5D9d37nwElGeydwtpoLePuhyuk6InatSG7I3rDAJNDbaLAUQLDtRERQslB9EKZNcGD9eAcjQYxf6LARfUjlYbBnBbGWMsGiOlKBRgGkDlRXqT0QEWK98oBiumPx6/uD3r4v7KL9BEXTudE581YdECfmH7nmcYo+PWWgzdGEHBvMc3deMdCYc4pHQOewEncBX2UStAIby6+t11q3FGgdedpsCTOli8R+O/lwcmWGNS6DXFwSwuV7aAeUKJMdFd4+of5kYSFdyzmW5alByEIWK5XlJwCFZUGnu5aSgYFLz/VXlA8a5oJbyChrZ+iuDaQvolaSr97OFGNX9IXrP2hN0M8Iee3O1EduOLw7bDJxX1B/NJfiQ5ipSJ0V4TeSo9DCpaKD6DZeVR7J5o144hygrnS8W8cEqSOUMjmRmXv9SISP17QMUEkNUreb6gAo3mm58rRzXStmvbj5cIalIsXyxpC/kvOZfhWgq1cSA22q3GQTtb2NEFx4OezgK6ic+qpY/LF3ci2F3aSlUiewRBluHDz8Fv5yzw1h82w2Rau0tfIivqU1geCSA/8="
    # DISTRIBUTION_ID
    - secure: "vupIcX6O8r2c51z8IsvidmPW6gLUQqWZsocqhSLt1m/z+6iXEKeSZZrJiJvzorEmnCdLu/24S3fjdOMhS3Vcnm6o25wAkuQ57J4hg+616t+pC/66yo+cy/SohLQwY/6LU8BYd9hkJRIKbSdiIkYhS3Ixh78/+fuowU4LfrS7UvFnZUXwom65dxPZiJfQYnFwnzCnBYLl4xIQE6Gb4+2KCNt8csY79tZ0PxHr+4jxUp0vN2Nf5KpYKEXOixFFmKH5ZMOKmhzBYAoTF+ANMjZBNUWCh0G0qmd0vsiybTFD3ie6Rn8u8p+Hvz4Xi+7v+lTr79jputZw/tvNh3VjZSB8ipL1tWEKvmjY4YwxBqhzqF5zGh/IUS4ixs77dD4zj+1kAX7SYxYjbPJdXhzriHAoF75+ffHVka2DcYLCckGxzDufscF4qVyNF0IjiXtUhT1bahorlO9PFdVksbJsBc31VpRy2sh8R58BRN0OYUpApJMwVYXyURuEAYst6+yIuBVk1PhE0dAP/QtOxXoKpvP9ccwGdgR27u5ByqTzHn0CYYgfGoDBbeNbOcgP06OK//qTKit1s60/g+qdfFjkCK0sTWWPnsGrSefDfuNlON4HoA03zkFObU9fxbiIQq0cAvx0hTCuK8Yy3aRHVz1epLRSOfEqz60960aXXVaLLodRTeI="
